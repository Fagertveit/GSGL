var GSGL={CONTAINER_ID:"gsgl-container",WIDTH:640,HEIGHT:480};GSGL.event={KEY:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,Y:88,X:89,Z:90,LEFTSUPER:91,RIGHTSUPER:92,SELECT:93,NUM0:96,NUM1:97,NUM2:98,NUM3:99,NUM4:100,NUM5:101,NUM6:102,NUM7:103,NUM8:104,NUM9:105,MULTIPLY:106,ADD:107,SUBSTRACT:108,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUAL:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222},GLYPH:{8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"CAPS",27:"ESCAPE",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"Y",89:"X",90:"Z",91:"LEFTSUPER",92:"RIGHTSUPER",93:"SELECT",96:"NUM0",97:"NUM1",98:"NUM2",99:"NUM3",100:"NUM4",101:"NUM5",102:"NUM6",103:"NUM7",104:"NUM8",105:"NUM9",106:"MULTIPLY",107:"ADD",108:"SUBSTRACT",110:"DECIMAL",111:"DIVIDE",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUMLOCK",145:"SCROLLLOCK",186:"SEMICOLON",187:"EQUAL",188:"COMMA",189:"DASH",190:"PERIOD",191:"FORWARDSLASH",192:"GRAVEACCENT",219:"OPENBRACKET",220:"BACKSLASH",221:"CLOSEBRAKET",222:"SINGLEQUOTE"},MouseManager:function(t){var e={X:0,Y:0,MB:[3],CLICK:[3],PREVENT_DEFAULT:!0,STOP_PROPAGATION:!0,LOGEVENTS:!1,RESOLUTION:!1,logger:new GSGL.utility.Logger({type:"Mouse Manager"}),container:{},constructor:function(t){var e=this;this.container=document.getElementById(t.target),this.MB[0]=!1,this.MB[1]=!1,this.MB[2]=!1,this.CLICK[0]=!1,this.CLICK[1]=!1,this.CLICK[2]=!1,this.container.addEventListener("click",function(t){e.setMouseClick(t)},!0),this.container.addEventListener("mousemove",function(t){e.setMousePosition(t)},!0),this.container.addEventListener("mousedown",function(t){e.setMouseDown(t)},!0),this.container.addEventListener("mouseup",function(t){e.setMouseUp(t)},!0)},setMouseDown:function(t){this.PREVENT_DEFAULT&&t.preventDefault(),this.STOP_PROPAGATION&&t.stopPropagation(),this.LOGEVENTS&&this.logger.log("Mouse down at x: "+this.X+" y: "+this.Y),this.MB[t.button]=!0},setMouseUp:function(t){this.PREVENT_DEFAULT&&t.preventDefault(),this.STOP_PROPAGATION&&t.stopPropagation(),this.LOGEVENTS&&this.logger.log("Mouse up at x: "+this.X+" y: "+this.Y),this.MB[t.button]=!1},setMouseClick:function(t){this.PREVENT_DEFAULT&&t.preventDefault(),this.STOP_PROPAGATION&&t.stopPropagation(),this.LOGEVENTS&&this.logger.log("Clicked at x: "+this.X+" y: "+this.Y),this.CLICK[t.button]=!0},clearClicks:function(){this.CLICK[0]=!1,this.CLICK[1]=!1,this.CLICK[2]=!1},setMousePosition:function(t){void 0!=t.pageX&&void 0!=t.pageY?(this.X=t.pageX,this.Y=t.pageY):(this.X=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.Y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),this.X-=this.container.offsetLeft,this.Y-=this.container.offsetTop,this.RESOLUTION&&(this.X=$resolution.getX(this.X),this.Y=$resolution.getY(this.Y))}};return e.constructor(t),e},KeyboardManager:function(){var t={KEYS:[256],PREVENT_DEFAULT:!1,STOP_PROPAGATION:!1,KEY_LOGGER:!1,logger:new GSGL.utility.Logger({type:"Keyboard Manager"}),constructor:function(){var t=this;window.addEventListener("keydown",function(e){t.setKeyDown(e)},!0),window.addEventListener("keyup",function(e){t.setKeyUp(e)},!0)},setKeyDown:function(t){this.PREVENT_DEFAULT&&t.preventDefault(),this.STOP_PROPAGATION&&t.stopPropagation(),this.KEY_LOGGER&&this.logger.log("Pressed key: "+GSGL.event.GLYPH[t.keyCode]+" keycode: "+t.keyCode,"Event"),this.KEYS[t.keyCode]=!0},setKeyUp:function(t){this.PREVENT_DEFAULT&&t.preventDefault(),this.STOP_PROPAGATION&&t.stopPropagation(),this.KEY_LOGGER&&this.logger.log("Released key: "+t.keyCode,"Event"),this.KEYS[t.keyCode]=!1},clearKeys:function(){for(var t in this.KEYS)this.KEYS[t]=!1}};return t.constructor(),t},TouchManager:function(t){var e={SWIPE_LEFT:!1,SWIPE_RIGHT:!1,SWIPE_UP:!1,SWIPE_DOWN:!1,X:0,Y:0,LOGEVENTS:!1,RESOLUTION:!1,logger:new GSGL.utility.Logger({type:"Touch Manager"}),container:{},activeTouchStart:{},constructor:function(t){var e=this;this.container=document.getElementById(t.target),this.container.addEventListener("touchstart",function(t){e.setTouchStart(t)},!0),this.container.addEventListener("touchend",function(t){e.setTouchEnd(t)},!0),this.container.addEventListener("touchcancel",function(t){e.setTouchCancel(t)},!0),this.container.addEventListener("touchmove",function(t){e.setTouchPosition(t)},!0)},setTouchStart:function(t){this.LOGEVENTS&&this.logger.log("We got a touch event, saving for future calculations",t),this.activeTouchStart=t},setTouchEnd:function(t){this.LOGEVENTS&&this.logger.log("A touch ended, calculating swipe",t),this.clearSwipes(),this.checkSwipe(t),this.activeTouchStart={}},setTouchCancel:function(t){this.LOGEVENTS&&this.logger.log("Touch cancelled")},setTouchPosition:function(t){void 0!=t.touches[0].pageX&&void 0!=t.touches[0].pageY?(this.X=t.touches[0].pageX,this.Y=t.touches[0].pageY):(this.X=t.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.Y=t.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop),this.X-=this.container.offsetLeft,this.Y-=this.container.offsetTop,this.RESOLUTION&&(this.X=$resolution.getX(this.X),this.Y=$resolution.getY(this.Y))},checkSwipe:function(t){var e=this.activeTouchStart.timeStamp,i=t.timeStamp;if(this.LOGEVENTS&&this.logger.log("Touch started at: "+e+" and ended at: "+i),1e3>i-e&&i-e>100){this.LOGEVENTS&&this.logger.log("Action is inside swipe time range, calculating direction");var s=this.activeTouchStart.touches[0].pageX,r=this.activeTouchStart.touches[0].pageY,n=t.changedTouches[0].pageX,o=t.changedTouches[0].pageY,h=Math.abs(n-s),a=Math.abs(o-r);this.LOGEVENTS&&this.logger.log("Swipe stats, startX: "+s+" startY: "+r+"endX: "+n+" endY: "+o+" Horizontal Distance: "+h+" Vertical Distance: "+a),h>a?0>n-s?(this.SWIPE_LEFT=!0,this.LOGEVENTS&&this.logger.log("Swiping Left")):(this.SWIPE_RIGHT=!0,this.LOGEVENTS&&this.logger.log("Swiping Right")):0>o-r?(this.SWIPE_UP=!0,this.LOGEVENTS&&this.logger.log("Swiping Up")):(this.SWIPE_DOWN=!0,this.LOGEVENTS&&this.logger.log("Swiping Down"))}},clearSwipes:function(){this.SWIPE_RIGHT=!1,this.SWIPE_LEFT=!1,this.SWIPE_UP=!1,this.SWIPE_DOWN=!1}};return e.constructor(t),e}},GSGL.geometry={Vector2D:function(t,e){var i={x:0,y:0,type:"vector2d",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},setX:function(t){this.x=t},getX:function(){return this.x},setY:function(t){this.y=t},getY:function(){return this.y},setPosition:function(t,e){this.x=t,this.y=e},getPosition:function(){return{x:this.x,y:this.y}},add:function(t){return new GSGL.geometry.Vector2D(this.x+t.x,this.y+t.y)},subtract:function(t){return new GSGL.geometry.Vector2D(this.x-t.x,this.y-t.y)},invert:function(){return new GSGL.geometry.Vector2D(-this.x,-this.y)},scale:function(t){return new GSGL.geometry.Vector2D(this.x*t,this.y*t)},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},length:function(){return Math.sqrt(this.lengthSquared())},lengthSquared:function(){return this.x*this.x+this.y*this.y},normalize:function(){var t=this.length();return 0==t?new GSGL.geometry.Vector2D(0,0):new GSGL.geometry.Vector2D(this.x/t,this.y/t)},project:function(t){var e,i;return e=this.dot(t),i=this.lengthSquared(),new GSGL.geometry.Vector2D(e/i*this.x,e/i*this.y)},angle:function(){return Math.atan2(this.x,-this.y)},distanceTo:function(t){var e=this.subtract(t);return e.length()},rotate:function(t){return 0==this.x&&(this.x+=GSGL.utility.EPSILON),0==this.y&&(this.y+=GSGL.utility.EPSILON),new GSGL.geometry.Vector2D(Math.cos(t)*this.x-Math.sin(t)*this.y,Math.sin(t)*this.x+Math.cos(t)*this.y)},rotatePivot:function(t,e,i){0==this.x&&(this.x+=GSGL.utility.EPSILON),0==this.y&&(this.y+=GSGL.utility.EPSILON);var t,e;return srcX=this.x,srcY=this.y,srcX-=t,srcY-=e,new GSGL.geometry.Vector2D(Math.cos(i)*srcX-Math.sin(i)*srcY+t,Math.sin(i)*srcX+Math.cos(i)*srcY+e)},render:function(){$g.beginPath(),$g.arc(this.x,this.y,1,0,2*Math.PI),$g.fill()},renderDirection:function(t,e){$g.beginPath(),$g.moveTo(t,e),$g.lineTo(t+this.x,e+this.y),$g.closePath(),$g.stroke()},renderArrow:function(t,e){var i;this.renderDirection(t,e),i=new GSGL.geometry.Vector2D(this.x,this.y),i=i.normalize(),i=i.rotate(GSGL.utility.degreeToRadian(30)),$g.beginPath(),$g.moveTo(t+this.x,e+this.y),$g.lineTo(t+this.x-10*i.x,e+this.y-10*i.y),$g.closePath(),$g.stroke(),i=i.rotate(GSGL.utility.degreeToRadian(-60)),$g.beginPath(),$g.moveTo(t+this.x,e+this.x),$g.lineTo(t+this.x-10*i.x,e+this.y-10*i.y),$g.closePath(),$g.stroke()},renderDestination:function(t,e){$g.beginPath(),$g.arc(t+this.x,e+this.y,2,0,2*Math.PI,!0),$g.fill()}};return i.constructor({x:t,y:e}),i},Vector3D:function(t,e,i){var s={x:0,y:0,z:0,type:"vector3d",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])}};return s.constructor({x:t,y:e,z:i}),s},Point:function(t,e){var i={x:0,y:0,type:"point",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},transform:function(t,e){this.x+=t,this.y+=e},setPosition:function(t,e){this.x=t,this.y=e},getPosition:function(){return{x:this.x,y:this.y}},setX:function(t){this.x=t},getX:function(){return this.x},setY:function(t){this.y=t},getY:function(){return this.y},render:function(){$g.beginPath(),$g.arc(this.x,this.y,1,0,2*Math.PI),$g.fill()}};return i.constructor({x:t,y:e}),i},Line:function(t){var e={p0:new GSGL.geometry.Point(0,0),p1:new GSGL.geometry.Point(1,1),type:"line",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},transform:function(t,e){this.p0.transform(t,e),this.p1.transform(t,e)},transformStart:function(t,e){this.p0.transform(t,e)},transformEnd:function(t,e){this.p1.transform(t,e)},setPosition:function(t,e,i,s){this.p0.setPosition(t,e),this.p1.setPosition(i,s)},render:function(){$g.beginPath(),$g.moveTo(this.p0.x,this.p0.y),$g.lineTo(this.p1.x,this.p1.y),$g.stroke()}};return e.constructor(t),e},Triangle:function(t){var e={p0:new GSGL.geometry.Point(1,0),p1:new GSGL.geometry.Point(1,1),p2:new GSGL.geometry.Point(0,1),type:"triangle",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},transform:function(t,e){this.p0.transform(t,e),this.p1.transform(t,e),this.p2.transform(t,e)},setPosition:function(t,e,i){this["p"+t].setPosition(e,i)},render:function(){$g.beginPath(),$g.moveTo(this.p0.x,this.p0.y),$g.lineTo(this.p1.x,this.p1.y),$g.lineTo(this.p2.x,this.p2.y),$g.lineTo(this.p0.x,this.p0.y),$g.stroke()}};return e.constructor(t),e},Rectangle:function(t){var e={pos:new GSGL.geometry.Point(0,0),width:1,height:1,type:"rectangle",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},transform:function(t,e){this.pos.transform(t,e)},setPosition:function(t,e){this.pos.setPosition(t,e)},setWidth:function(t){this.width=t},getX:function(){return this.pos.getX()},getY:function(){return this.pos.getY()},getWidth:function(){return this.width},setHeight:function(t){this.height=t},getHeight:function(){return this.height},render:function(){$g.strokeRect(this.pos.x,this.pos.y,this.width,this.height)}};return e.constructor(t),e},AABB:function(t){var e={pos:new GSGL.geometry.Point(0,0),hWidth:1,hHeight:1,type:"aabb",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},transform:function(t,e){this.pos.transform(t,e)},setPosition:function(t,e){this.pos.setPosition(t,e)},setHalfWidth:function(t){this.hWidth=t},getHalfWidth:function(){return this.hWidth},setHalfHeight:function(t){this.hHeight=t},getHalfHeight:function(){return this.hHeight},render:function(){$g.strokeRect(this.pos.x-this.hWidth,this.pos.y-this.hHeight,2*this.hWidth,2*this.hHeight)}};return e.constructor(t),e},Plane:function(t){var e={type:"plane",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])}};return e.constructor(t),e},Circle:function(t){var e={pos:new GSGL.geometry.Point(0,0),radius:1,type:"circle",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},transform:function(t,e){this.pos.transform(t,e)},setPosition:function(t,e){this.pos.setPosition(t,e)},setX:function(t){this.pos.setX(t)},getX:function(){return this.pos.getX()},setY:function(t){this.pos.setY(t)},getY:function(){return this.pos.getY()},setRadius:function(t){this.radius=t},getRadius:function(){return this.radius},render:function(){$g.beginPath(),$g.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),$g.stroke()}};return e.constructor(t),e},Polygon:function(t){var e={points:[],type:"polygon",constructor:function(t){var e,i;for(e=0,i=t.length,e;i>e;e+=1)this.addPoint(t[e])},addPoint:function(t){this.points.push(t)},removePoint:function(t){this.points.slice(t,1)},removeFirst:function(){this.points.shift()},removeLast:function(){this.points.pop()},render:function(){var t,e;if(e=1,t=this.points.length,3>t)return 0;for($g.beginPath(),$g.moveTo(this.points[0].x,this.points[0].y),e;t>e;e+=1)$g.lineTo(this.points[e].x,this.points[e].y);$g.lineTo(this.points[0].x,this.points[0].y),$g.stroke()}};return e.constructor(t),e},Bezier:function(t){var e={p0:new GSGL.geometry.Vector2D(0,0),p1:new GSGL.geometry.Vector2D(0,1),c0:new GSGL.geometry.Vector2D(1,0),c1:new GSGL.geometry.Vector2D(1,1),render_step:.01,type:"bezier",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},getPoint:function(t){if(0!=t){var e,t,i,s,r,n;e=1-t,tt=t*t,i=e*e,s=i*e,r=tt*t,n=this.p0.scale(s),n=n.add(this.c0.scale(3*i*t)),n=n.add(this.c1.scale(3*e*tt)),n=n.add(this.p1.scale(r))}else n=this.p0;return n},setStartPoint:function(t,e){this.p0.setPosition(t,e)},setEndPoint:function(t,e){this.p1.setPosition(t,e)},setControlPoint:function(t,e,i){this["c"+t].setPosition(e,i)},setRenderStep:function(t){this.render_step=t},render:function(){var t,e;for(t=0,e=1/this.render_step,$g.beginPath(),$g.moveTo(this.p0.x,this.p0.y),t;e>t;t++){var i=this.getPoint(t*this.render_step);$g.lineTo(i.x,i.y)}$g.lineTo(this.p1.x,this.p1.y),$g.stroke()},renderEdit:function(){var t,e;for(t=0,e=1/this.render_step,$g.beginPath(),$g.moveTo(this.p0.x,this.p0.y),t;e>t;t++){var i=this.getPoint(t*this.render_step);$g.lineTo(i.x,i.y)}$g.lineTo(this.p1.x,this.p1.y),$g.stroke(),$g.save(),$g.lineWidth=1,$g.beginPath(),$g.arc(this.c0.x,this.c0.y,4,2*Math.PI,!1),$g.stroke(),$g.beginPath(),$g.arc(this.c1.x,this.c1.y,4,2*Math.PI,!1),$g.stroke(),$g.beginPath(),$g.moveTo(this.p0.x,this.p0.y),$g.lineTo(this.c0.x,this.c0.y),$g.stroke(),$g.beginPath(),$g.moveTo(this.p1.x,this.p1.y),$g.lineTo(this.c1.x,this.c1.y),$g.stroke(),$g.restore(),$g.fillRect(this.p0.x-3,this.p0.y-3,6,6),$g.fillRect(this.p1.x-3,this.p1.y-3,6,6)}};return e.constructor(t),e},BSpline:function(t){var e={points:[],degree:2,range:2,render_step:.01,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},addPoint:function(t){this.points.push(t)},removePoint:function(t){this.points.splice(t,1)},removeFirst:function(){this.points.shift()},removeLast:function(){this.points.pop()},setDegree:function(t){"number"==typeof t&&t>=2&&5>=t&&(this.degree=t),2==this.degree||3==this.degree?this.range=2:this.range=3},basisDeg2:function(t){return t>=-.5&&.5>t?.75-t*t:t>=.5&&1.5>=t?1.125+(-1.5+t/2)*t:t>=-1.5&&-.5>t?1.125+(1.5+t/2)*t:0},basisDeg3:function(t){return t>=-1&&0>t?2/3+(-1-t/2)*t*t:t>=1&&2>=t?4/3+t*(-2+(1-t/6)*t):t>=-2&&-1>t?4/3+t*(2+(1+t/6)*t):t>=0&&1>t?2/3+(-1+t/2)*t*t:0},basisDeg4:function(t){return t>=-1.5&&-.5>t?55/96+t*(-(5/24)+t*(-1.25+(-(5/6)-t/6)*t)):t>=.5&&1.5>t?55/96+t*(5/24+t*(-1.25+(5/6-t/6)*t)):t>=1.5&&2.5>=t?625/384+t*(-(125/48)+t*(25/16+(-(5/12)+t/24)*t)):t>=-2.5&&-1.5>=t?625/384+t*(125/48+t*(25/16+(5/12+t/24)*t)):t>=-1.5&&1.5>t?115/192+t*t*(-0.625+t*t/4):0},basisDeg5:function(t){return t>=-2&&-1>t?.425+t*(-0.625+t*(-1.75+t*(-1.25+(-0.375-t/24)*t))):t>=0&&1>t?.55+t*t*(-.5+(.25-t/12)*t*t):t>=2&&3>=t?2.025+t*(-3.375+t*(9/4+t*(-.75+(1/8-t/120)*t))):t>=-3&&-2>t?2.025+t*(27/8+t*(9/4+t*(.75+(1/8+t/120)*t))):t>=1&&2>t?.425+t*(5/8+t*(-1.75+t*(5/4+(-0.375+t/24)*t))):t>=-1&&0>t?.55+t*t*(-.5+(.25+t/12)*t*t):0},getLength:function(t){var e,i,s,r,n,o=[],h=0,a=0,c=0,u=0;o[0]=0,t||(t=100),i=this.points.length*t,r=new GSGL.geometry.Vector2D(this.points[0].x,this.points[0].y);var l=1,g=i;for(l;g>l;l+=1)e=l/i,s=this.getPoint(e),n=new GSGL.geometry.Vector2D(s.x,s.y),h+=n.distanceTo(r),r=new GSGL.geometry.Vector2D(s.x,s.y),a=(this.points.length-1)*e,c=Math.floor(a),c!=u&&(o[c]=h.toFixed(8),u=c);return o[o.length]=h,{chunks:o,total:h}},reparametrizeByArcLength:function(t){var e,i,s,r,n,o,h=[],a=1,c=this.points.length,u=this.getLength(100);for(h.push(new GSGL.geometry.Point(this.points[0].x,this.points[0].y)),a;c>a;a+=1){e=u.chunks[a]-u.chunks[a-1],i=Math.ceil(t*e/u.total),r=(a-1)/(this.points.length-1),o=a/(this.points.length-1);var l=1;for(l;i-1>l;l+=1)n=r+l*(1/i)*(o-r),s=this.getPoint(n),h.push(new GSGL.geometry.Point(s.x,s.y))}this.points=h},interpolate:function(t,e){var i=this["basisDeg"+this.degree],s=Math.floor(e),r=0,n=s-this.range,o=s+this.range;for(n;o>=n;n+=1)r+=t(n)*i(e-n);return r},sequenceAt:function(t){var e=this.points,i=this.degree+1;return function(s){return i>s?e[0][t]:e.length+i<=s?e[e.length-1][t]:e[s-i][t]}},getPoint:function(t){var e=this.points.length;return t*=2*(this.degree+1)+e,new GSGL.geometry.Point(this.interpolate(this.sequenceAt("x"),t),this.interpolate(this.sequenceAt("y"),t))},render:function(){var t,e;for(t=0,e=1/this.render_step,$g.beginPath(),$g.moveTo(this.points[0].x,this.points[0].y),t;e>t;t++){var i=this.getPoint(t*this.render_step);$g.lineTo(i.x,i.y)}e=this.points.length-1,$g.lineTo(this.points[e].x,this.points[e].y),$g.stroke()},renderEdit:function(){var t,e;for(t=0,e=1/this.render_step,$g.beginPath(),$g.moveTo(this.points[0].x,this.points[0].y),t;e>t;t++){var i=this.getPoint(t*this.render_step);$g.lineTo(i.x,i.y)}for(e=this.points.length-1,$g.lineTo(this.points[e].x,this.points[e].y),$g.stroke(),t=0,e=this.points.length,t;e>t;t+=1)$g.beginPath(),$g.arc(this.points[t].x,this.points[t].y,4,2*Math.PI,!1),$g.stroke()}};return e.constructor(t),e}},GSGL.graphics={Sprite:function(t){var e={uid:0,source:"",image:new Image,logger:new GSGL.utility.Logger("image"),width:0,height:0,loaded:!1,manager:{},constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key]);void 0!=this.source&&this.load(this.source)},load:function(t){this.uid=$resourceManager.addResource("image"),this.source=t,this.image.setAttribute("src",t),this.addEventListeners()},render:function(t,e){$g.drawImage(this.image,t,e)},renderSize:function(t,e,i,s){$g.drawImage(this.image,t,e,i,s)},renderSegment:function(t,e,i,s,r,n){$g.drawImage(this.image,i,s,r,n,t,e,this.width,this.height)},renderSegmentSize:function(t,e,i,s,r,n,o,h){$g.drawImage(this.image,i,s,r,n,t,e,o,h)},loadHandler:function(t){this.loaded=!0,$resourceManager.setLoaded(this.uid)},errorHandler:function(t){$log.add("image","Error loading image!")},addEventListeners:function(){var t=this;this.image.addEventListener("load",function(e){t.loadHandler(e)}),this.image.addEventListener("error",function(e){t.errorHandler(e)})}};return e.constructor(t),e},SpriteSheet:function(){},Animation:function(){},Color:function(t){var e={r:0,g:0,b:0,a:0,h:0,s:0,l:0,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},setRGB:function(t,e,i){this.r=t,this.g=e,this.b=i,this.RGBtoHSL()},setHSL:function(t,e,i){this.h=t,this.s=e,this.l=i,this.HSLtoRGB()},setAlpha:function(t){this.a=t},setRGBA:function(t,e,i,s){this.setRGB(t,e,i),this.setAlpha(s)},getRGB:function(){return{r:this.r,g:this.g,b:this.b}},getHSL:function(){return{h:this.h,s:this.s,l:this.l}},setRed:function(t){this.r=t},setGreen:function(t){this.g=t},setBlue:function(t){this.b=t},setHue:function(t){this.h=t},setSaturation:function(t){this.s=t},setLightness:function(t){this.l=t},getAlpha:function(){return this.a},getRGBA:function(){return{r:this.r,g:this.g,b:this.b,a:this.a}},getRGBAFloat:function(){return{r:this.toFloat(this.r),g:this.toFloat(this.g),b:this.toFloat(this.b),a:this.toFloat(this.a)}},getRGBAFloatArray:function(){return[this.toFloat(this.r),this.toFloat(this.g),this.toFloat(this.b),this.a]},getRGBAInt:function(){return{r:this.toInt(this.r),g:this.toInt(this.g),b:this.toInt(this.b),a:this.toInt(this.a)}},RGBtoHSL:function(){var t,e,i,s,r,n,o,h,a,c,u;s=this.r,r=this.g,n=this.b,o=s>r?s:r,n>o&&(o=n),h=r>s?s:r,h>n&&(h=n),i=o/255,e=0!=o?(o-h)/o:0,0==e?t=0:(a=(o-s)/(o-h),c=(o-r)/(o-h),u=(o-n)/(o-h),t=s==o?u-c:r==o?2+a-u:4+c-a,t/=6,0>t&&(t+=1)),this.h=t,this.s=e,this.l=i},HSLtoRGB:function(){var t,e,i,s,r,n,o,h,a,c,u;if(t=0,e=0,i=0,r=this.h,n=this.s,o=this.l,0==this.s)t=Math.floor(255*o+.5),e=Math.floor(255*o+.5),i=Math.floor(255*o+.5);else switch(s=6*(r-Math.floor(r)),h=s-Math.floor(s),a=o*(1-n),c=o*(1-n*h),u=o*(1-n*(1-h)),Math.floor(s)){case 0:t=255*o+.5,e=255*u+.5,i=255*a+.5;break;case 1:t=255*c+.5,e=255*o+.5,i=255*a+.5;break;case 2:t=255*a+.5,e=255*o+.5,i=255*u+.5;break;case 3:t=255*a+.5,e=255*c+.5,i=255*o+.5;break;case 4:t=255*u+.5,e=255*a+.5,i=255*o+.5;break;case 5:t=255*o+.5,e=255*a+.5,i=255*c+.5}this.r=Math.floor(t),this.g=Math.floor(e),this.b=Math.floor(i)},getHex:function(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)},setHex:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);this.r=parseInt(e[1],16),this.g=parseInt(e[2],16),this.b=parseInt(e[3],16),this.RGBtoHSL()},toFloat:function(t){return 0!=t?t/255:0},toInt:function(t){return 255*t}};return e.constructor(t),e},interpolate:function(t,e,i){var s=new GSColor({r:0,g:0,b:0,a:255}),r=t.getRGBAFloat(),n=e.getRGBAFloat();return s.r=r.r+(n.r-r.r)*i,s.g=r.g+(n.g-r.g)*i,s.b=r.b+(n.b-r.b)*i,s.a=r.a+(n.a-r.a)*i,s.getRGBAInt()}},GSGL.physics={pointLine:function(t,e){},pointTriangle:function(t,e){},pointCircle:function(t,e){var i,s,r;return i=new GSGL.geometry.Vector2D(t.x,t.y),s=new GSGL.geometry.Vector2D(e.pos.x,e.pos.y),r=s.subtract(i).length(),r<e.radius},pointRectangle:function(t,e){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height},pointPolygon:function(t,e){},lineLine:function(t,e){},lineTriangle:function(t,e){},lineCircle:function(t,e){},lineRectangle:function(t,e){},linePolygon:function(t,e){},triangleTriangle:function(t,e){},triangleCircle:function(t,e){},triangleRectangle:function(t,e){},trianglePolygon:function(t,e){},circleCircle:function(t,e){var i,s,r;return i=new GSGL.geometry.Vector2D(t.pos.x,t.pos.y),s=new GSGL.geometry.Vector2D(e.pos.x,e.pos.y),len=s.subtract(i).length(),r=t.radius+e.radius,len<r},circleRectangle:function(t,e){},circlePolygon:function(t,e){},rectangleRectangle:function(t,e){return t.pos.x+t.width>=e.pos.x&&t.pos.y+t.height>=e.pos.y&&t.pos.x<=e.pos.x+e.width&&t.pos.y<=e.pos.y+e.height},rectanglePolygon:function(t,e){},polygonPolygon:function(t,e){},intersects:function(t,e){return"function"==typeof GSGL.physics[t.type+GSGL.utility.capitalize(e.type)]?GSGL.physics[t.type+GSGL.utility.capitalize(e.type)](t,e):"function"==typeof GSGL.physics[e.type+GSGL.utility.capitalize(t.type)]?GSGL.physics[e.type+GSGL.utility.capitalize(t.type)](e,t):0}},GSGL.resource={_UID:0,GetUniqueId:function(){return GSGL.resource._UID++,GSGL.resource._UID},ResourceManager:function(t){var e={resources:{},total:{images:0,imagesLoaded:0,audio:0,audioLoaded:0,files:0,filesLoaded:0},constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},addResource:function(t){var e=new GSGL.resource.Resource({type:t,id:GSGL.resource.GetUniqueId()});switch(this.resources[e.getId()]=e,this.total.files+=1,t){case"image":this.total.images+=1;break;case"audio":this.total.audio+=1;break;default:this.imageResources+=1}return e.getId()},setLoaded:function(t){switch(this.resources[t].setLoaded(!0),this.total.filesLoaded+=1,this.resources[t].getType()){case"image":this.total.imagesLoaded+=1;break;case"audio":this.total.audioLoaded+=1}},checkProgress:function(t){var e={total:0,loaded:0,percent:0};if(void 0!=t)switch(t){case"image":e.total=this.total.images,e.loaded=this.total.imagesLoaded;break;case"audio":e.total=this.total.audio,e.loaded=this.total.audioLoaded;break;default:e.total=this.total.files,e.loaded=this.total.filesLoaded}else e.total=this.total.files,e.loaded=this.total.filesLoaded;return 0!=e.total&&0!=e.loaded&&(e.percent=Math.ceil(e.loaded/e.total*100)),e},isLoaded:function(){var t=this.checkProgress();return 100==t.percent?!0:!1}};return e.constructor(t),e},Resource:function(t){var e={id:0,type:"image",loaded:!1,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},getId:function(){return this.id},setType:function(t){this.type=t},getType:function(){return this.type},setLoaded:function(t){this.loaded=t},getLoaded:function(){return this.loaded}};return e.constructor(t),e}},GSGL.surface={Surface2D:function(t){var e={logger:new GSGL.utility.Logger({type:"2d Surface"}),width:640,height:360,pos:{x:0,y:0,z:1},id:"",canvas:{},constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key]);this.logger.log("Created 2d Surface",this),this.generateCanvas()},generateCanvas:function(){var t=document.getElementById(GSGL.CONTAINER_ID);this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",this.id),this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this.canvas.style.position="absolute",this.canvas.style.top=this.pos.y,this.canvas.style.left=this.pos.x,this.canvas.style.zIndex=this.pos.z,t.appendChild(this.canvas)},getContext:function(){return this.canvas.getContext("2d")},clear:function(t){var e=this.getContext();e.clearRect(0,0,this.width,this.height),void 0!=t&&(e.save(),e.fillStyle="#ffffff",e.fillRect(0,0,this.width,this.height),e.restore())},toDataUrl:function(){return this.canvas.toDataUrl("image/png")},setPos:function(t,e,i){this.pos.x=t,this.pos.y=e,this.pos.z=i},setPosZ:function(t){this.pos.z=t}};return e.constructor(t),e},Surface3D:function(t){var e={logger:new GSGL.utility.Logger({type:"3d Surface"}),width:640,height:360,pos:{x:0,y:0,z:1},id:"",canvas:{},constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key]);this.logger.log("Created 3d Surface",this),this.generateCanvas()},generateCanvas:function(){var t=document.getElementById(GSGL.CONTAINER_ID);this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",this.id),this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this.canvas.style.position="absolute",this.canvas.style.top=this.pos.y,this.canvas.style.left=this.pos.x,this.canvas.style.zIndex=this.pos.z,t.appendChild(this.canvas)},initContext:function(){gl=null;try{gl=this.canvas.getContext("experimental-webgl",{preserveDrawingBuffer:!0})||this.canvas.getContext("webgl",{preserveDrawingBuffer:!0})}catch(t){return this.logger.log("Doh!, Something went wrong: "+t),0}this.logger.log("WebGL initialized successfully!"),gl.clearColor(0,0,0,1)},clear:function(){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)},toUrl:function(){return this.canvas.toDataURL("image/png")}};return e.constructor(t),e}},GSGL.ui={Button:function(t){var e={shape:{},title:"Button",states:{inactive:{background:new GSGL.graphics.Color({r:255,g:255,b:255}),color:new GSGL.graphics.Color({r:0,g:0,b:0}),border:new GSGL.graphics.Color({r:0,g:0,b:0})},hover:{background:new GSGL.graphics.Color({r:200,g:200,b:200}),color:new GSGL.graphics.Color({r:0,g:0,b:0}),border:new GSGL.graphics.Color({r:255,g:0,b:0})}},currentState:"inactive",callback:{},hover:!1,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},update:function(){var t=new GSGL.geometry.Point($mouse.X,$mouse.Y);this.hover=$intersects(t,this.shape),this.hover?(this.currentState="hover",$mouse.CLICK[0]&&"function"==typeof this.callback&&this.callback()):this.currentState="inactive"},render:function(){$g.save(),$g.font="14px Helvetica",$g.textAlign="center",$g.textBaseline="middle",$g.fillStyle=this.states[this.currentState].background.getHex(),$g.strokeStyle=this.states[this.currentState].border.getHex(),$g.strokeRect(this.shape.getX(),this.shape.getY(),this.shape.getWidth(),this.shape.getHeight()),$g.fillRect(this.shape.getX(),this.shape.getY(),this.shape.getWidth(),this.shape.getHeight()),$g.fillStyle=this.states[this.currentState].color.getHex(),$g.fillText(this.title,this.shape.getX()+this.shape.getWidth()/2,this.shape.getY()+this.shape.getHeight()/2),$g.restore()}};return e.constructor(t),e},Radio:function(t){var e={constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])}};return e.constructor(t),e},Checkbox:function(t){var e={constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])}};return e.constructor(t),e}},GSGL.utility={EPSILON:1e-6,PI:Math.PI,Resolution:function(t){var e={WIDTH:0,HEIGHT:0,REAL_WIDTH:0,REAL_HEIGHT:0,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key]);console.log("Real width: "+this.REAL_WIDTH+" Real height: "+this.REAL_HEIGHT+" Width: "+this.WIDTH+" Height: "+this.HEIGHT)},getX:function(t){return t/this.REAL_WIDTH*this.WIDTH},getY:function(t){return t/this.REAL_HEIGHT*this.HEIGHT},getWidth:function(t){return this.REAL_WIDTH/this.WIDTH*t},getHeight:function(t){return this.REAL_HEIGHT/this.HEIGHT*t}};return e.constructor(t),e},Ajax:function(t){var e={async:!1,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},createXHR:function(){try{return new XMLHttpRequest}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}return null},load:function(t,e){var i=this.createXHR();i&&(i.open("GET",t,this.async),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e(i)},i.send(null))}};return e.constructor(t),e},Logger:function(t){var e={console:!0,type:"",constructor:function(t){this.type=t.type},canLogToConsole:function(){"object"==typeof console?this.console=!0:this.console=!1},log:function(t,e){this.console&&("object"==typeof e?console.log("["+this.type+"]"+t,e):console.log("["+this.type+"]"+t))},debug:function(t,e){},info:function(t,e){this.console&&("object"==typeof e?console.info("["+this.type+"]"+t,e):console.info("["+this.type+"]"+t))}};return e.constructor(t),e},degreeToRadian:function(t){return t*(GSGL.utility.PI/180)},radianToDegree:function(t){return t*(180/GSGL.utility.PI)},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}},GSGL.tilemap={Tilemap:function(t){var e={layers:[],tilesets:[],width:0,height:0,tilewidth:0,tileheight:0,backgroundcolor:new GSGL.graphics.Color,ready:!1,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},loadTiledMap:function(t){var e=this,i=new GSGL.utility.Ajax;i.load(t,function(t){var i=JSON.parse(t.responseText);console.log(i),e.width=i.width,e.height=i.height,e.tilewidth=i.tilewidth,e.tileheight=i.tileheight,e.backgroundcolor.setHex(i.backgroundcolor);for(var s in i.layers)e.layers.push(new GSGL.tilemap.TilemapLayer(i.layers[s])),e.layers[s].decodeTileData();for(var s in i.tilesets)e.tilesets.push(new GSGL.tilemap.Tileset(i.tilesets[s])),e.tilesets[s].loadTexture();
console.log(e)})},render:function(t,e){for(var i in this.layers)if(this.layers[i].isVisible())for(var s in this.layers[i].tiles){var r=this.layers[i].getTile(s),n=this.tilewidth*r.col+t,o=this.tileheight*r.row+e;0!=r.tileid&&this.tilesets[0].renderTile(n,o,r.tileid)}}};return e.constructor(t),e},TilemapLayer:function(t){var e={tiles:[],data:"",encoding:"base64",height:0,width:0,x:0,y:0,visible:!0,opacity:1,type:"tilelayer",name:"",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},decodeTileData:function(){for(var t=atob(this.data),e=4,i=t.length/4,s=0;i>s;s++){this.tiles[s]=0;for(var r=e-1;r>=0;--r)this.tiles[s]+=t.charCodeAt(s*e+r)<<(r<<3)}console.log(this.tiles)},isVisible:function(){return this.visible},getTile:function(t){return{tileid:this.tiles[t],row:Math.floor(t/this.width),col:t%this.width}}};return e.constructor(t),e},Tileset:function(t){var e={image:"",imagewidth:0,imageheight:0,tilecount:0,tilewidth:0,tileheight:0,firstgid:0,columns:0,margin:0,spacing:0,name:"",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},loadTexture:function(){$textureManager.addTexture(this.image,this.name)},renderTile:function(t,e,i){var s=Math.floor((i-this.firstgid)/this.columns),r=(i-this.firstgid)%this.columns,n=[r*this.tilewidth/this.imagewidth,s*this.tileheight/this.imageheight,(r*this.tilewidth+this.tilewidth)/this.imagewidth,(s*this.tileheight+this.tileheight)/this.imageheight],o={texture:this.name,vertices:[t,e,t+this.tilewidth,e,t,e+this.tileheight,t+this.tilewidth,e+this.tileheight],uvs:[n[0],n[1],n[2],n[1],n[0],n[3],n[2],n[3]],indices:[0,1,2,1,2,3],numIndices:6};$renderManager.addToCall(0,"default",this.name,o)}};return e.constructor(t),e},Tile:function(t){var e={constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])}};return e.constructor(t),e}},GSGL.gl={VERTEX_SHADER:0,FRAGMENT_SHADER:1,Application:function(t){var e={container:"",lastDelta:(new Date).getTime(),timerId:0,targetFps:20,lastUpdate:0,fps:30,frames:0,width:640,height:480,canvasId:"",logger:new GSGL.utility.Logger({type:"WebGL Application"}),constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key]);this.initGlobals()},initGlobals:function(){$surface=new GSGL.surface.Surface3D({id:this.canvasId,width:this.width,height:this.height}),$surface.initContext(),GSGL.WIDTH=this.width,GSGL.HEIGHT=this.height;var t=$surface.canvas.clientWidth,e=$surface.canvas.clientHeight;$resolution=new GSGL.utility.Resolution({WIDTH:GSGL.WIDTH,HEIGHT:GSGL.HEIGHT,REAL_WIDTH:t,REAL_HEIGHT:e}),$mouse=new GSGL.event.MouseManager({target:GSGL.CONTAINER_ID}),$mouse.RESOLUTION=!0,$touch=new GSGL.event.TouchManager({target:GSGL.CONTAINER_ID}),$touch.RESOLUTION=!0,$keyboard=new GSGL.event.KeyboardManager,$intersects=GSGL.physics.intersects,$ajax=new GSGL.utility.Ajax({}),$resources=new GSGL.resource.ResourceManager,$textureManager=new GSGL.gl.texture.TextureManager,$shaderManager=new GSGL.gl.shader.ShaderManager,$renderManager=new GSGL.gl.render.RenderManager2D},start:function(){var t=this;$resources.isLoaded()?this.timerId=window.setInterval(function(){t.step()},1e3/t.targetFps):window.setTimeout(function(){t.start()},100)},stop:function(){window.clearInterval(this.timerId)},step:function(){this.update()},update:function(){var t=(new Date).getTime(),e=t-this.lastDelta;this.lastDelta=t,this.state.update(e),this.state.render(e),this.showFps&&this.renderFps(),t-this.lastUpdate>1e3?(this.fps=this.frames,this.frames=0,this.lastUpdate=t):this.frames+=1,$mouse.clearClicks()},setState:function(t){var e=this;this.stop(),this.state=new t({application:e}),this.start()}};return e.constructor(t),e}},GSGL.gl.shader={ShaderManager:function(t){var e={programs:{},constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},createProgram:function(t,e,i){this.programs[i]=new GSGL.gl.shader.Program,this.programs[i].initShaders(t,e)},getProgram:function(t){return this.programs[t].getProgram()},useProgram:function(t){gl.useProgram(this.programs[t].getProgram())}};return e.constructor(t),e},Program:function(t){var e={vShader:{},fShader:{},program:{},logger:new GSGL.utility.Logger("shader"),constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},loadShader:function(t,e){t==GSGL.gl.VERTEX_SHADER?this.vShader=this.compileShader(t,e):this.fShader=this.compileShader(t,e)},compileShader:function(t,e){var i;if(t==GSGL.gl.VERTEX_SHADER)i=gl.createShader(gl.VERTEX_SHADER);else{if(t!=GSGL.gl.FRAGMENT_SHADER)return this.logger.log("No valid shader type specified"),0;i=gl.createShader(gl.FRAGMENT_SHADER)}return gl.shaderSource(i,e),gl.compileShader(i),gl.getShaderParameter(i,gl.COMPILE_STATUS)?(this.logger.log("Shader compiled correctly."),i):(this.logger.log(gl.getShaderInfoLog(i)),0)},initShaders:function(t,e){var i=this;$ajax.load(t,function(t){i.loadShader(GSGL.gl.FRAGMENT_SHADER,t.responseText)}),$ajax.load(e,function(t){i.loadShader(GSGL.gl.VERTEX_SHADER,t.responseText)}),this.program=gl.createProgram(),gl.attachShader(this.program,this.vShader),gl.attachShader(this.program,this.fShader),gl.linkProgram(this.program),gl.getProgramParameter(this.program,gl.LINK_STATUS)?(this.logger.log("Shader program initialized without error."),gl.useProgram(this.program)):this.logger.log("Unable to initialize the shader program.")},getProgram:function(){return this.program}};return e.constructor(t),e}},GSGL.gl.particle={Particle:function(t){var e={pos:{x:0,y:0},vel:1,dir:{x:0,y:0},size:1,startLife:1e3,life:0,alpha:1,constructor:function(){for(key in t)void 0!=this[key]&&(this[key]=t[key])},update:function(t,e,i,s){this.life-=s,this.size+=i,this.dir.y+=t,this.dir.x+=e,this.pos.x+=this.dir.x*this.vel,this.pos.y+=this.dir.y*this.vel},isDead:function(){return this.life<0?!0:!1}};return e.constructor(t),e},ParticleEmitter:function(t){var e={particles:[],texture:{},pos:{x:0,y:0},dir:{max:{x:0,y:0},min:{x:0,y:0}},vel:{min:2,max:5},startSize:{min:16,max:32},constant:!1,growth:.1,color:[.9,.5,.1,.4],angularVel:0,gravity:0,wind:0,life:{min:200,max:500},particlesPerSecond:100,particlesAtStart:100,lifeCycle:1e3,currLife:0,shaderManager:{},blendSrc:gl.SRC_ALPHA,blendDst:gl.ONE,program:{},vertices:[],sizes:[],constructor:function(){for(key in t)void 0!=this[key]&&(this[key]=t[key])},update:function(t){if(this.vertices.splice(0,this.vertices.length),this.sizes.splice(0,this.sizes.length),this.constant){var e=Math.ceil(t/1e3*this.particlesPerSecond),i=0;for(i;e>i;i+=1)this.addParticle()}else if(this.currLife-=t,this.currLife<0){var i=0;for(i;i<this.particlesAtStart;i+=1)this.addParticle();this.currLife=this.lifeCycle}i=0;var s=this.particles.length;for(i;s>i;i+=1)this.particles[i].update(this.gravity,this.wind,this.growth,t),this.particles[i].isDead()?(this.particles.splice(i,1),s-=1):(this.vertices.push(this.particles[i].pos.x),this.vertices.push(this.particles[i].pos.y),this.sizes.push(this.particles[i].size))},addParticle:function(){var t=new GSGL.gl.particle.Particle({pos:{x:this.pos.x,y:this.pos.y},vel:this.randomMinMax(this.vel.min,this.vel.max),dir:{x:this.randomMinMax(this.dir.min.x,this.dir.max.x),y:this.randomMinMax(this.dir.min.y,this.dir.max.y)},angle:0,angleVel:this.angleVel,size:this.randomMinMax(this.startSize.min,this.startSize.max),startLife:this.life,life:this.randomMinMax(this.life.min,this.life.max),alpha:1});this.particles.push(t)},randomMinMax:function(t,e){return Math.random()*(e-t)+t},render:function(t){var e=$shaderManager.getProgram("particle");gl.useProgram(e),gl.enable(gl.BLEND),gl.blendFunc(this.blendSrc,this.blendDst),this.resolutionLoc=gl.getUniformLocation(e,"u_resolution"),gl.uniform2f(this.resolutionLoc,GSGL.WIDTH,GSGL.HEIGHT),this.positionLoc=gl.getAttribLocation(e,"a_position"),this.pointSizeLoc=gl.getAttribLocation(e,"a_pointSize"),this.colorLoc=gl.getUniformLocation(e,"u_color"),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.uniform4f(this.colorLoc,this.color[0],this.color[1],this.color[2],this.color[3]);var i=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,i),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.vertices),gl.STATIC_DRAW),gl.enableVertexAttribArray(this.positionLoc),gl.vertexAttribPointer(this.positionLoc,2,gl.FLOAT,!1,0,0);var s=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,s),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.sizes),gl.STATIC_DRAW),gl.enableVertexAttribArray(this.pointSizeLoc),gl.vertexAttribPointer(this.pointSizeLoc,1,gl.FLOAT,!1,0,0),gl.drawArrays(gl.POINTS,0,this.vertices.length/2),gl.disableVertexAttribArray(this.positionLoc),gl.disableVertexAttribArray(this.pointSizeLoc)}};return e.constructor(t),e},ParticleSystem:function(t){var e={emitters:[],FBOTexture:{},FBOWidth:512,FBOHeight:512,FBO:{},constructor:function(){for(key in t)void 0!=this[key]&&(this[key]=t[key])},addEmitter:function(t){this.emitters.push(t)},removeEmitter:function(t){this.emitters.splice(t,1)},switchEmitter:function(t,e){var i=this.emitters[e];this.emitters[e]=this.emitters[t],this.emitters[t]=i},getParticleAmount:function(){var t=0,e=this.emitters.length,i=0;for(t;e>t;t+=1)i+=this.emitters[t].particles.length;return i},update:function(t){var e=0,i=this.emitters.length;for(e;i>e;e+=1)this.emitters[e].update(t)},render:function(t){var e=0,i=this.emitters.length;for(e;i>e;e+=1)this.emitters[e].render(t)},bindFBO:function(){this.FBO=gl.createFramebuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,this.FBO),this.FBO.width=this.FBOWidth,this.FBO.height=this.FBOHeight,this.FBOTexture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.FBOTexture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.FBOWidth,this.FBOHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null);var t=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,t),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,this.FBOWidth,this.FBOHeight),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.FBOTexture,0),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,t),gl.bindTexture(gl.TEXTURE_2D,null),gl.bindRenderbuffer(gl.RENDERBUFFER,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null)}};return e.constructor(t),e}},GSGL.gl.font={Font:function(t){var e={sprite:[],loaded:[],glyphs:[],config:{},base:0,lineHeight:0,color:[1,1,1,1],customSprite:!1,src:"",align:"left",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key]);""!=this.src&&this.load(this.src)},load:function(t){var e=this;$ajax.load(t,function(t){e.config=t.responseXML,e.customSprite?e.parseConfigCustomSprite():e.parseConfig()})},configCustomSprite:function(t,e,i,s,r,n,o){},createSprite:function(t){},parseConfig:function(){var t=this.config.getElementsByTagName("page"),e=this.config.getElementsByTagName("char"),i=this.config.getElementsByTagName("common");this.lineHeight=parseInt(i[0].getAttribute("lineHeight")),this.base=parseInt(i[0].getAttribute("base")),this.scaleW=parseInt(i[0].getAttribute("scaleW")),this.scaleH=parseInt(i[0].getAttribute("scaleH"));var s=0,r=t.length;for(s;r>s;s+=1){var n=t[s].getAttribute("id"),o=t[s].getAttribute("file");$textureManager.addTexture("font/"+o,"font"+n),this.sprite[n]=new GSGL.gl.sprite.Sprite({texture:"font"+n,width:this.scaleW,height:this.scaleH,hasColor:!0,color:this.color})}for(s=0,r=e.length,s;r>s;s+=1){var n,h,a,c,u,l,g,d,f;n=parseInt(e[s].getAttribute("id")),h=parseInt(e[s].getAttribute("x")),a=parseInt(e[s].getAttribute("y")),c=parseInt(e[s].getAttribute("width")),u=parseInt(e[s].getAttribute("height")),l=parseInt(e[s].getAttribute("xoffset")),g=parseInt(e[s].getAttribute("yoffset")),d=parseInt(e[s].getAttribute("xadvance")),f=parseInt(e[s].getAttribute("page")),this.glyphs[n]=new GSGL.gl.font.Glyph({x:h,y:a,width:c,height:u,xOffset:l,yOffset:g,xAdvance:d,page:f})}},parseConfigCustomSprite:function(t,e,i,s,r,n,o){},setColor:function(t,e,i,s){this.color=[t,e,i,s];var r=0,n=this.sprite.length;for(r;n>r;r+=1)this.sprite[r].setColor(t,e,i,s)},setAlign:function(t){this.align=t},getAlign:function(){return this.align},getLineHeight:function(){return this.lineHeight},getBase:function(){return this.base},drawString:function(t,e,i){var s=e,r=0,n=t.length;if("center"==this.align){var o=this.stringWidth(t);s=e-Math.floor(o/2)}else if("right"==this.align){var o=this.stringWidth(t);s=e-o}for(r;n>r;r+=1){var h=t.charCodeAt(r);void 0!=this.glyphs[h]&&(this.sprite[this.glyphs[h].page].renderSub(s+this.glyphs[h].xOffset,i+this.glyphs[h].yOffset,this.glyphs[h].x,this.glyphs[h].y,this.glyphs[h].width,this.glyphs[h].height),s+=this.glyphs[h].xAdvance)}},stringWidth:function(t){var e=0,i=0,s=t.length;for(i;s>i;i+=1){var r=t.charCodeAt(i);e+=this.glyphs[r].xAdvance}return e}};return e.constructor(t),e},Glyph:function(t){var e={x:0,y:0,xOffset:0,yOffset:0,width:0,height:0,xAdvance:0,page:0,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])}};return e.constructor(t),e}},GSGL.gl.render={RenderManager2D:function(t){var e={uid:0,renderCalls:{},positionLoc:{},texCoordLoc:{},colorLoc:{},noTextureLoc:{},noColorLoc:{},resolutionLoc:{},vertexBuffer:{},indicesBuffer:{},texCoordBuffer:{},constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},initRenderer:function(){var t=$shaderManager.getProgram("default");this.resolutionLoc=gl.getUniformLocation(t,"u_resolution"),this.positionLoc=gl.getAttribLocation(t,"a_position"),this.texCoordLoc=gl.getAttribLocation(t,"a_texCoord"),this.colorLoc=gl.getUniformLocation(t,"u_color"),this.noTextureLoc=gl.getUniformLocation(t,"no_texture"),this.noColorLoc=gl.getUniformLocation(t,"no_color"),this.vertexBuffer=gl.createBuffer(),this.indicesBuffer=gl.createBuffer(),this.texCoordBuffer=gl.createBuffer()},clearCalls:function(){this.renderCalls={}},addToCall:function(t,e,i,s){var r=""+t+";"+e+";"+i;s.hasColor&&(r+=";r"+s.color[0]+";g"+s.color[1]+";b"+s.color[2]+";a"+s.color[3]),void 0==this.renderCalls[r]&&(this.renderCalls[r]=new GSGL.gl.render.RenderCall({texture:i,program:e,zIndex:t})),this.renderCalls[r].add(s)},orderByZIndex:function(){},render:function(){this.flush(),this.clearCalls()},flush:function(){gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.uniform2f(this.resolutionLoc,GSGL.WIDTH,GSGL.HEIGHT);for(key in this.renderCalls)this.renderCalls[key].hasTexture?(gl.uniform1i(this.noTextureLoc,0),gl.bindTexture(gl.TEXTURE_2D,$textureManager.getTexture(this.renderCalls[key].texture))):gl.uniform1i(this.noTextureLoc,1),this.renderCalls[key].hasColor?(gl.uniform1i(this.noColorLoc,0),gl.uniform4f(this.colorLoc,this.renderCalls[key].color[0],this.renderCalls[key].color[1],this.renderCalls[key].color[2],this.renderCalls[key].color[3])):gl.uniform1i(this.noColorLoc,1),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.renderCalls[key].vertices),gl.STATIC_DRAW),gl.enableVertexAttribArray(this.positionLoc),gl.vertexAttribPointer(this.positionLoc,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,this.texCoordBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.renderCalls[key].uvs),gl.STATIC_DRAW),gl.enableVertexAttribArray(this.texCoordLoc),gl.vertexAttribPointer(this.texCoordLoc,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.renderCalls[key].indices),gl.STATIC_DRAW),gl.drawElements(gl.TRIANGLES,this.renderCalls[key].numIndices,gl.UNSIGNED_SHORT,0)}};return e.constructor(t),e},RenderCall:function(t){var e={vertices:[],indices:[],uvs:[],index:0,numIndices:0,texture:{},program:{},zIndex:0,color:[0,0,0,1],hasColor:!1,hasTexture:!0,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},add:function(t){this.vertices=this.vertices.concat(t.vertices),this.uvs=this.uvs.concat(t.uvs);var e=0,i=t.indices.length;for(e;i>e;e+=1)this.indices.push(t.indices[e]+this.index);this.index+=this.findMaxIndex(t.indices),this.numIndices+=t.numIndices,t.hasColor&&(this.hasColor=!0,this.color=t.color)},findMaxIndex:function(t){var e=0,i=t.length,s=0;for(e;i>e;e+=1)t[e]>s&&(s=t[e]);return s+=1},flush:function(){this.vertices=[],this.indices=[],this.uvs=[],this.index=0,this.numIndices=0},setProgram:function(t){this.program=t},setTexture:function(t){this.texture=t},setZIndex:function(t){this.zIndex=t}};return e.constructor(t),e}},GSGL.gl.texture={TextureManager:function(t){var e={textures:{},constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},addTexture:function(t,e){this.textures[e]=new GSGL.gl.texture.Texture({src:t})},removeTexture:function(t){gl.deleteTexture(this.texture[t].texture)},getTexture:function(t){return this.textures[t].texture}};return e.constructor(t),e},Texture:function(t){var e={id:0,image:new Image,logger:new GSGL.utility.Logger("image"),width:0,height:0,texture:null,isLoaded:!1,isReady:!1,onLoaded:{},src:"",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key]);""!=this.src&&this.load(this.src)},load:function(t){this.texture=gl.createTexture(),this.id=$resources.addResource("image"),this.addEventListeners(),this.image.src=t},init:function(){gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this.image),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.bindTexture(gl.TEXTURE_2D,null),this.isReady=!0},loadedHandler:function(t){this.isLoaded=!0,this.width=this.image.width,this.height=this.image.height,$resources.setLoaded(this.id),this.init(),"function"==typeof this.onLoaded&&this.onLoaded()},errorHandler:function(t){this.logger.log("Failed to load image "+this.image.src)},addEventListeners:function(){var t=this;this.image.addEventListener("load",function(e){t.loadedHandler(e)},!0),this.image.addEventListener("error",function(e){t.errorHandler(e)},!0)}};return e.constructor(t),e}},GSGL.gl.sprite={Sprite:function(t){var e={uv:[0,0,1,1],color:[1,1,1,1],width:0,height:0,texture:"",hasColor:!1,zIndex:0,program:"default",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},setUV:function(t,e,i,s){this.uv=[t,e,i,s]},setUVPixels:function(t,e,i,s,r,n){this.uv=[i/t,s/e,(i+r)/t,(s+n)/e]},setColor:function(t,e,i,s){this.color=[t,e,i,s]},render:function(t,e,i){var s={texture:this.texture,vertices:[t,e,t+this.width,e,t,e+this.height,t+this.width,e+this.height],uvs:[this.uv[0],this.uv[1],this.uv[2],this.uv[1],this.uv[0],this.uv[3],this.uv[2],this.uv[3]],indices:[0,1,2,1,2,3],numIndices:6};this.hasColor&&(s.hasColor=!0,s.color=this.color),$renderManager.addToCall(this.zIndex,this.program,this.texture,s)},renderScale:function(t,e,i){var s={texture:this.texture,vertices:[t,e,t+this.width*i,e,t,e+this.height*i,t+this.width*i,e+this.height*i],uvs:[this.uv[0],this.uv[1],this.uv[2],this.uv[1],this.uv[0],this.uv[3],this.uv[2],this.uv[3]],indices:[0,1,2,1,2,3],numIndices:6};this.hasColor&&(s.hasColor=!0,s.color=this.color),$renderManager.addToCall(this.zIndex,this.program,this.texture,s)},renderAngle:function(t,e,i){var s,r,n=[];s=t+this.width/2,r=e+this.height/2,n[0]=new GSGL.geometry.Vector2D(t,e),n[1]=new GSGL.geometry.Vector2D(t+this.width,e),n[2]=new GSGL.geometry.Vector2D(t,e+this.height),n[3]=new GSGL.geometry.Vector2D(t+this.width,e+this.height);var o=0,h=4;for(o;h>o;o+=1)n[o]=n[o].rotatePivot(s,r,GSGL.utility.degreeToRadian(i));var a={texture:this.texture,vertices:[n[0].x,n[0].y,n[1].x,n[1].y,n[2].x,n[2].y,n[3].x,n[3].y],uvs:[this.uv[0],this.uv[1],this.uv[2],this.uv[1],this.uv[0],this.uv[3],this.uv[2],this.uv[3]],indices:[0,1,2,1,2,3],numIndices:6};this.hasColor&&(a.hasColor=!0,a.color=this.color),$renderManager.addToCall(this.zIndex,this.program,this.texture,a)},renderAngleScale:function(t,e,i,s){var r,n,o=[];r=t+this.width*s/2,n=e+this.height*s/2,o[0]=new GSGL.geometry.Vector2D(t,e),o[1]=new GSGL.geometry.Vector2D(t+this.width*s,e),o[2]=new GSGL.geometry.Vector2D(t,e+this.height*s),o[3]=new GSGL.geometry.Vector2D(t+this.width*s,e+this.height*s);var h=0,a=4;for(h;a>h;h+=1)o[h]=o[h].rotatePivot(r,n,GSGL.utility.degreeToRadian(i));var c={texture:this.texture,vertices:[o[0].x,o[0].y,o[1].x,o[1].y,o[2].x,o[2].y,o[3].x,o[3].y],uvs:[this.uv[0],this.uv[1],this.uv[2],this.uv[1],this.uv[0],this.uv[3],this.uv[2],this.uv[3]],indices:[0,1,2,1,2,3],numIndices:6};this.hasColor&&(c.hasColor=!0,c.color=this.color),$renderManager.addToCall(this.zIndex,this.program,this.texture,c)},renderSub:function(t,e,i,s,r,n,o){var h=[];h[0]=parseFloat(i)/parseFloat(this.width),h[1]=parseFloat(s)/parseFloat(this.height),h[2]=parseFloat(i+r)/parseFloat(this.width),h[3]=parseFloat(s+n)/parseFloat(this.height);var a={texture:this.texture,vertices:[t,e,t+r,e,t,e+n,t+r,e+n],uvs:[h[0],h[1],h[2],h[1],h[0],h[3],h[2],h[3]],indices:[0,1,2,1,2,3],numIndices:6};this.hasColor&&(a.hasColor=!0,a.color=this.color),$renderManager.addToCall(this.zIndex,this.program,this.texture,a)}};return e.constructor(t),e},AnimatedSprite:function(t){var e={frames:[],loop:!1,active:!0,frameTime:100,currentFrame:0,currentDelta:0,constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},play:function(){this.active=!0},stop:function(){this.active=!1,this.currentFrame=0,this.currentDelta=0},pause:function(){this.active=!1},update:function(t){this.active&&(this.currentDelta+=t,this.currentDelta>this.frameTime&&(this.currentDelta=0,this.nextFrame()))},nextFrame:function(){this.currentFrame+=1,this.currentFrame>=this.frames.length&&(this.loop||(this.active=!1),this.currentFrame=0)},render:function(t,e){this.frames[this.currentFrame].render(t,e)}};return e.constructor(t),e}},GSGL.gl.ui={Button:function(t){var e={states:["INACTIVE","HOVER","ACTIVE"],sprites:[],shape:{},state:0,callback:{},title:"",constructor:function(t){for(key in t)void 0!=this[key]&&(this[key]=t[key])},update:function(t){var e=new GSGL.geometry.Point($mouse.X,$mouse.Y);$intersects(e,this.shape)?(this.state=1,$mouse.CLICK[0]&&(this.state=2,"function"==typeof this.callback&&this.callback()),$mouse.MB[0]&&(this.state=2)):this.state=0},render:function(t){if(this.sprites[this.state].render(this.shape.pos.x,this.shape.pos.y),""!=this.title){$font.getAlign();$font.setAlign("center");var e=this.shape.pos.y+this.shape.height/2-$font.getLineHeight()/2;$font.drawString(this.title,this.shape.pos.x+this.shape.width/2,e)}}};return e.constructor(t),e}};